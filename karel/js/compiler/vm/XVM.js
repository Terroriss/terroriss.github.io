function XVM(){VM.call(this);this.initOperators()}XVM.prototype=new VM;XVM.prototype.constructor=XVM;
XVM.prototype.initOperators=function(){this.defineOperator(new PrefixOp("+",function(a){return a}));this.defineOperator(new PrefixOp("-",function(a){return-a}));this.defineOperator(new PrefixOp("!",function(a){return!a}));this.defineOperator(new InfixOp("+",function(a,b){return a+b}));this.defineOperator(new InfixOp("-",function(a,b){return a-b}));this.defineOperator(new InfixOp("*",function(a,b){return a*b}));this.defineOperator(new InfixOp("/",function(a,b){return a/b}));this.defineOperator(new InfixOp("%",
function(a,b){return a%b}));this.defineOperator(new InfixOp("==",function(a,b){return a==b}));this.defineOperator(new InfixOp("!=",function(a,b){return a!=b}));this.defineOperator(new InfixOp("<",function(a,b){return a<b}));this.defineOperator(new InfixOp("<=",function(a,b){return a<=b}));this.defineOperator(new InfixOp(">",function(a,b){return a>b}));this.defineOperator(new InfixOp(">=",function(a,b){return a>=b}));this.defineOperator(new AssignOp("="));this.defineOperator(new AssignOp("+=",function(a,
b){return a+b}));this.defineOperator(new AssignOp("-=",function(a,b){return a-b}));this.defineOperator(new AssignOp("*=",function(a,b){return a*b}));this.defineOperator(new AssignOp("/=",function(a,b){return a/b}));this.defineOperator(new AssignOp("%=",function(a,b){return a%b}));this.defineOperator(new PrefixIncDecOp("++"));this.defineOperator(new PrefixIncDecOp("--"));this.defineOperator(new PostfixIncDecOp("++"));this.defineOperator(new PostfixIncDecOp("--"));this.defineOperator(new ShortCircuitOp("&&"));
this.defineOperator(new ShortCircuitOp("||"));this.defineOperator(new QuestionMarkColonOp);this.defineOperator(new CallIns)};function PrefixIncDecOp(a){this.name="pre"+a;this.fn="++"==a?function(b){return b+1}:function(b){return b-1}}PrefixIncDecOp.prototype.toString=function(){return this.name};PrefixIncDecOp.prototype.compile=function(a,b,c){a.compile(b[1],c);c.push(this);c.push(new StoreIns(b[1]))};PrefixIncDecOp.prototype.execute=function(a){a.push(this.fn(a.pop()))};
function PostfixIncDecOp(a,b){this.name="post"+a;this.fn=b}PostfixIncDecOp.prototype.toString=function(){return this.name};PostfixIncDecOp.prototype.compile=function(a,b,c){a.compile(b[1],c);c.push(new DupIns);c.push(this);c.push(new StoreIns(b[1]));c.push(new PopIns)};PostfixIncDecOp.prototype.execute=function(a){a.push(this.fn(a.pop()))};function ShortCircuitOp(a){this.name=a}ShortCircuitOp.prototype.toString=function(){return this.name};
ShortCircuitOp.prototype.compile=function(a,b,c){var d=new JumpIns("&&"==this.name?"jumpf":"jumpt");a.compile(b[1],c);c.push(new DupIns);c.push(d);c.push(new PopIns);a.compile(b[2],c);d.setTarget(c.length)};function QuestionMarkColonOp(){this.name="?:"}QuestionMarkColonOp.prototype.toString=function(){return name};
QuestionMarkColonOp.prototype.compile=function(a,b,c){var d=new JumpIns("jumpf"),e=new JumpIns("jump");a.compile(b[1],c);c.push(d);a.compile(b[2],c);c.push(e);d.setTarget(c.length);a.compile(b[3],c);e.setTarget(c.length)};
