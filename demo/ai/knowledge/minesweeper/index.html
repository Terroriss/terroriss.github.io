<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-207880070-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-207880070-1', {
        cookie_flags: 'max-age=7200;secure;samesite=none'
      });
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Hugo 0.88.1" />
    <meta name="description" content="">
<meta name="author" content="Minh Long">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />

    <title>Demo AI | Minesweeper</title>
    
    <link href="/css/main-style.css?1634704945" rel="stylesheet">
    <script src="/js/jquery-3.3.1.min.js?1634704945"></script>
    <link href="/css/dark-mode-btn.css?1634704945" rel="stylesheet">
    <link href="/css/dark-mode.css?1634704945" rel="stylesheet">
    
        <link href="/js/demo/minesweeper/minesweeper.css" rel="stylesheet">
    <script src="/js/demo/minesweeper/minesweeper.js"></script>
    <script src="/js/demo/minesweeper/minesweeperAI.js"></script>
    </head>
<boby class="background minesweeper-body" style="overflow-x: hidden;">
        <div class="game-play">
            <div class="board">
            </div>
        </div>
        <div class="game-setting">
            <div class="game-go-home">
                <a class="demo-link" href="/" title="Home" >âŒ‚</a>
            </div>
            <div class="game-init">
                <div style="margin: 8px 0px;">
                    <div class="input-container">
                    <label for="new_rows">Rows:</label>
                    <input type="number" id="new_rows" placeholder="rows" value="15" min="3" max="50"/>
                    </div>
                    <div class="input-container">
                    <label for="new_cols">Cols:</label>
                    <input type="number" id="new_cols" placeholder="cols" value="15" min="3" max="50" />
                    </div>
                    <div class="input-container">
                    <label for="new_mines">Mines:</label>
                    <input type="number" id="new_mines" placeholder="mines" value="16" min="1" max="2000"/>
                    </div>
                </div>
                <div id="button-group" style="display: flex; justify-content: space-between;">
                <input id="new_game_button" type="button" value="Create new game!" />
                <div id="button-group-2"></div>
                </div>
            </div>
            <div class="game-status"></div>
            <div class="game-console"></div>
            <div class="game-control">
                <div id="button-group-1"></div>
            </div>
        </div>
        <script>
            var r = document.querySelector(':root');
            var gameplay = document.querySelector(".game-play")
            var board = document.querySelector(".board")
            var gameconsole = document.querySelector(".game-console")
            var gamestatus = document.querySelector(".game-status")
            var cell_size
            var cell_columns = check_number(document.getElementById("new_cols").value, 3, 50)
            var cell_rows = check_number(document.getElementById("new_rows").value, 3, 50)
            var mines = check_number(document.getElementById("new_mines").value, 1, 2000) 
            if (mines > cell_rows * cell_columns) mines = Math.floor(4 * (cell_rows * cell_columns) / 5);
            var game = new Minesweeper(cell_rows, cell_columns, mines) 
            var ai = new MinesweeperAI(cell_rows, cell_columns) 
            var i, j
            var endGame = false
            var move = null
            var revealed = new ArraySet()
            var flags = new ArraySet()
            var na = document.createElement("span")
            var button_group = '<input onclick="ai_play()" type="button" value="AI  Play" /><input onclick="ai_stop()" type="button" value="AI  Stop" /><input onclick="cheat()" type="button" value="Cheat" />'
            var btn_group_1 = document.getElementById("button-group-1")
            var btn_group_2 = document.getElementById("button-group-2")
            
            if (window.innerWidth < 555) {
                btn_group_1.innerHTML = ""
                btn_group_2.innerHTML = button_group
                var tmp = window.innerHeight * 0.6
                gameplay.setAttribute("style",`height: ${tmp}px`); 
                document.getElementById("new_game_button").setAttribute("value", "Create")
            } else {
                btn_group_2.innerHTML = ""
                btn_group_1.innerHTML = button_group
                gameplay.setAttribute("style","height: 100vh;"); 
                document.getElementById("new_game_button").setAttribute("value", "Create new game!")
            }
            na.innerHTML = "New game: " + cell_columns + " x " + cell_rows + ": " + mines + " mines"
            gameconsole.appendChild(na)
            gamestatus.innerHTML = 'Playing<span class="one-dot">.</span><span class="two-dot">.</span><span class="three-dot">.</span>'
            set_game_board()
            create_game()
            window.addEventListener("resize", function() {
                if (window.innerWidth < 555) {
                    btn_group_1.innerHTML = ""
                    btn_group_2.innerHTML = button_group
                    var tmp = window.innerHeight * 0.6
                    gameplay.setAttribute("style",`height: ${tmp}px`);
                    document.getElementById("new_game_button").value = "Create"
                } else {
                    btn_group_2.innerHTML = ""
                    btn_group_1.innerHTML = button_group
                    gameplay.setAttribute("style","height: 100vh;"); 
                    document.getElementById("new_game_button").value="Create new game!"
                }
                set_game_board()
            })
            
            function updateConsole(){
                gameconsole.scrollTop = gameconsole.scrollHeight;
            }
            
            function set_game_board() {
                var positionInfo = gameplay.getBoundingClientRect();
                var height = positionInfo.height;
                var width = positionInfo.width;
                var cell_value = Math.floor(Math.min((Math.min(width, height) * 0.9) / cell_rows, (Math.min(width, height) * 0.9) / cell_columns))
                r.style.setProperty('--cell', cell_value + "px" );
                var font_size = cell_value / 2.3
                font_size = cell_value < 15 ? cell_value : font_size < 15 ? 15 : font_size
                r.style.setProperty('--cell-font', font_size + "px" );
                var height = cell_value * cell_rows + cell_rows + 1
                var width = cell_value * cell_columns + cell_columns + 1
                r.style.setProperty('--board-height',  height + "px");
                r.style.setProperty('--board-width', width + "px");
            }
            
            function create_game() {
                while (board.hasChildNodes())
                    board.firstChild.remove()
                let content = "";
                for (i = 0; i < cell_rows; i++) {
                    content += '<div class="row">';
                    for (j = 0; j < cell_columns; j++) {
                        content += `<div class="cell" data-x="${i}" data-y="${j}"></div>`;
                    }
                    content += "</div>";
                }
                board.innerHTML = content;
                
                board.addEventListener("click", function(e) {
                    e.preventDefault();
                    const target = e.target;
                    if (!endGame) {
                        if (target.classList.contains("cell")) {
                            let x = parseInt(target.getAttribute("data-x"), 10)
                            let y = parseInt(target.getAttribute("data-y"), 10)
                            if (!revealed.has([x, y])) {
                                if (game.is_mine([x, y])) {
                                    revealed.add([x, y])
                                    endGame = true
                                    ai_stop()
                                    gamestatus.innerHTML = "<p class='status-lost'>Lost</p>"
                                    target.classList.add("red-mine")
                                    show_all_mines()
                                } else {
                                    nearby = game.nearby_mines([x, y])
                                    revealed.add([x, y])
                                    ai.add_knowledge([x, y], nearby)
                                    let p = document.createElement("span")
                                    if (nearby != 0) {
                                        p.innerHTML = nearby
                                        p.classList.add("count-"+nearby)
                                    }
                                    target.classList.add("revealed")
                                    target.appendChild(p)
                                }
                            }
                        }
                    }
                })
                
                board.addEventListener("contextmenu", function(e) {
                    e.preventDefault();
                    const target = e.target;
                    if (!endGame) {
                        if (target.classList.contains("cell")) {
                            let x = parseInt(target.getAttribute("data-x"), 10)
                            let y = parseInt(target.getAttribute("data-y"), 10)
                            if (!revealed.has([x, y])) {
                                let c = document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`)
                                if (flags.has([x, y])) {
                                    flags.delete([x, y])
                                    while (c.hasChildNodes())
                                        c.firstChild.remove()
                                    c.classList.remove("flag")
                                } else {
                                    flags.add([x, y])
                                    c.innerHTML = "<img class='cell-img' src='/js/demo/minesweeper/flag.png' alt='flag'>"
                                    c.classList.add("flag")
                                    game.mines_found = flags
                                    if (game.won()) {
                                        endGame = true;
                                        ai_stop()
                                        gamestatus.innerHTML = "<p class='status-won'>Won</p>"
                                    }
                                }
                            } else if (flags.has([x, y])) {
                                flags.delete([x, y])
                                while (c.hasChildNodes())
                                    c.firstChild.remove()
                                c.classList.remove("flag")
                            }
                        }
                    }
                });
            }
            
            function check_number(n, mn, mx) {
                let tmp = parseInt(n, 10)
                return tmp < mn ? mn : tmp > mx ? mx : tmp
            }
            
            function show_all_mines() {
                if (endGame)
                for (i = 0; i < cell_rows; i++) {
                    for (j = 0; j < cell_columns; j++) {
                        if (game.is_mine([i, j])) {
                            let c = document.querySelector(`.cell[data-x="${i}"][data-y="${j}"]`)
                            c.classList.add("mine")
                            c.innerHTML = ""
                            c.innerHTML = "<img class='cell-img' src='/js/demo/minesweeper/mine.png' alt='mine'>"
                        }
                    }
                }
            }
            
            window.addEventListener("DOMContentLoaded", () => {
                document.getElementById("new_game_button").addEventListener("click", function() {
                    ai_stop()
                    cell_columns = check_number(document.getElementById("new_cols").value, 3, 50)
                    cell_rows = check_number(document.getElementById("new_rows").value, 3, 50)
                    mines = check_number(document.getElementById("new_mines").value, 1, 2000) 
                    if (mines > cell_rows * cell_columns) mines = Math.floor(4 * (cell_rows * cell_columns) / 5);
                    game = new Minesweeper(cell_rows, cell_columns, mines) 
                    ai = new MinesweeperAI(cell_rows, cell_columns) 
                    endGame = false
                    move = null
                    revealed = new ArraySet()
                    flags = new ArraySet()
                    na = document.createElement("span")
                    gamestatus.innerHTML = 'Playing<span class="one-dot">.</span><span class="two-dot">.</span><span class="three-dot">.</span>'
                    na.innerHTML = "New game: " + cell_columns + " x " + cell_rows + ": " + mines + " mines"
                    gameconsole.innerHTML = ""
                    gameconsole.appendChild(na)
            
                    set_game_board()
                    create_game()
                })
            })
            
            function ai_play() {
                if(!endGame) setInterval(aiMove, 100)
            }
                
            function ai_stop() {
                const interval_id = window.setInterval(function(){}, Number.MAX_SAFE_INTEGER);
                for (let i = 1; i < interval_id; i++) {
                    window.clearInterval(i);
                }
            }
                
            function cheat() {
                    let h = game.height;
                    let w = game.width;
                    let content = "<table>"
                    for (let t = 0; t < h; t++) {
                        content += "<tr>";
                        let row = "";
                        for (let m = 0; m < w; m++) {
                            if (game.board[t][m]) row += "<th>X</th>";
                            else row += "<th>&nbsp&nbsp</th>";
                        }
                        content += row + "</tr>";
                    }
                    content += "</table>"
                    let c = document.createElement("span")
                    c.innerHTML = content;
                    gameconsole.appendChild(c)
                }
            
            function aiMove() {
                if(!endGame) {
                    var message = document.createElement("span")
                    var move = ai.make_safe_move()
                    if (move == null) {
                        move = ai.make_random_move()
                        if (move)
                            message.innerHTML = "No known safe moves, AI making random move."
                        else
                            message.innerHTML = "No moves left to make."
                    } else {
                        message.innerHTML = "AI making safe move."
                    }
                    gameconsole.appendChild(message)
                    updateConsole()
                    var mines_found = ai.mines
                    var ai_flags = minusSet(mines_found, flags)
                    if (move) {
                        let evt = document.createEvent('MouseEvents');
                        evt.initMouseEvent('click', true, true, document.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
                        document.querySelector(`.cell[data-x="${move[0]}"][data-y="${move[1]}"]`).dispatchEvent(evt);
                    }
                    const s_i = ai_flags[Symbol.iterator]()
                    for (let c = 0; c < ai_flags.size; c++) {
                        let curr = s_i.next().value.split(",")
                        let evt = document.createEvent('MouseEvents');
                        evt.initMouseEvent('contextmenu', true, true, document.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
                        document.querySelector(`.cell[data-x="${curr[0]}"][data-y="${curr[1]}"]`).dispatchEvent(evt);
                    }
                }
            }
        </script>

    <div style="position: fixed; left: 20px; bottom: 20px;">
        <input id="dark-toggle" class="dark-toggle" type="checkbox">
<script>
    $(function() {      
        let notSupport = localStorage.getItem("not_sp");

        if (notSupport == "true") {
            var link = $("<link />",{
             rel: "stylesheet",
             type: "text/css",
             href: "/css/dark-btn-mobile.css"
           })
           $('head').append(link);
        }
     });

    const mode = localStorage.getItem("dark_mode");
    const dark_btn = document.querySelector("#dark-toggle");
    const bg = document.querySelector("body").classList
    if (!bg.contains("background")) bg.add("background")
    if (mode) {
        if (mode == "true") {
            bg.remove("light-mode")
            dark_btn.checked = true;
        } else {
            bg.add("light-mode")
            dark_btn.checked = false;
        }
    } else {
        const device_color = window.matchMedia("(prefers-color-scheme: dark)");
        if (device_color.matches) dark_mode(true);
        else dark_mode(false);
    }
    
    function dark_mode(bool) {
        if (bool) {
            bg.remove("light-mode")
            localStorage.setItem("dark_mode", true);
            dark_btn.checked = true;
        } else {
            bg.add("light-mode")
            localStorage.setItem("dark_mode", false);
            dark_btn.checked = false;
        }
    }
       
    dark_btn.addEventListener("click", function() {
        const _bg = document.querySelector(".background").classList
        if (!_bg.contains("background-transition"))
            _bg.add("background-transition"); 
        if (this.checked) dark_mode(true);
        else dark_mode(false);
    });
</script>

    </div>
</body>
</html>
