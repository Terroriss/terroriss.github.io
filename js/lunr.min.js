var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(m){var n=0;return function(){return n<m.length?{done:!1,value:m[n++]}:{done:!0}}};$jscomp.arrayIterator=function(m){return{next:$jscomp.arrayIteratorImpl(m)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(m,n,p){if(m==Array.prototype||m==Object.prototype)return m;m[n]=p.value;return m};$jscomp.getGlobal=function(m){m=["object"==typeof globalThis&&globalThis,m,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var n=0;n<m.length;++n){var p=m[n];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(m,n){var p=$jscomp.propertyToPolyfillSymbol[n];if(null==p)return m[n];p=m[p];return void 0!==p?p:m[n]};$jscomp.polyfill=function(m,n,p,q){n&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(m,n,p,q):$jscomp.polyfillUnisolated(m,n,p,q))};$jscomp.polyfillUnisolated=function(m,n,p,q){p=$jscomp.global;m=m.split(".");for(q=0;q<m.length-1;q++){var r=m[q];if(!(r in p))return;p=p[r]}m=m[m.length-1];q=p[m];n=n(q);n!=q&&null!=n&&$jscomp.defineProperty(p,m,{configurable:!0,writable:!0,value:n})};$jscomp.polyfillIsolated=function(m,n,p,q){var r=m.split(".");m=1===r.length;q=r[0];q=!m&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var x=0;x<r.length-1;x++){var D=r[x];if(!(D in q))return;q=q[D]}r=r[r.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[r]:null;n=n(p);null!=n&&(m?$jscomp.defineProperty($jscomp.polyfills,r,{configurable:!0,writable:!0,value:n}):n!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[r]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[r]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(r):$jscomp.POLYFILL_PREFIX+p+"$"+r),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[r],{configurable:!0,writable:!0,value:n})))};$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(m){if(m)return m;var n=function(x,D){this.$jscomp$symbol$id_=x;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:D})};n.prototype.toString=function(){return this.$jscomp$symbol$id_};var p="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",q=0,r=function(x){if(this instanceof r)throw new TypeError("Symbol is not a constructor");return new n(p+(x||"")+"_"+q++,x)};return r},"es6","es3");$jscomp.polyfill("Symbol.iterator",function(m){if(m)return m;m=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),p=0;p<n.length;p++){var q=$jscomp.global[n[p]];"function"===typeof q&&"function"!=typeof q.prototype[m]&&$jscomp.defineProperty(q.prototype,m,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return m},"es6","es3");$jscomp.iteratorPrototype=function(m){m={next:m};m[Symbol.iterator]=function(){return this};return m};$jscomp.iteratorFromArray=function(m,n){m instanceof String&&(m+="");var p=0,q=!1,r={next:function(){if(!q&&p<m.length){var x=p++;return{value:n(x,m[x]),done:!1}}q=!0;return{done:!0,value:void 0}}};r[Symbol.iterator]=function(){return r};return r};$jscomp.polyfill("Array.prototype.keys",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(n){return n})}},"es6","es3");!function(){var m,n,p,q,r,x,D,O,P,Q,R,G,S,T,U,V,W,X,Y,Z,aa,ba,ca,da,b=function(a){var c=new b.Builder;return c.pipeline.add(b.trimmer,b.stopWordFilter,b.stemmer),c.searchPipeline.add(b.stemmer),a.call(c,c),c.build()};b.version="2.3.5";b.utils={};b.utils.warn=(m=this,function(a){m.console&&console.warn&&console.warn(a)});b.utils.asString=function(a){return null==a?"":a.toString()};b.utils.clone=function(a){if(null==a)return a;for(var c=Object.create(null),d=Object.keys(a),e=0;e<d.length;e++){var f=d[e],g=a[f];if(Array.isArray(g))c[f]=g.slice();else{if("string"!=typeof g&&"number"!=typeof g&&"boolean"!=typeof g)throw new TypeError("clone is not deep and does not support nested objects");c[f]=g}}return c};b.FieldRef=function(a,c,d){this.docRef=a;this.fieldName=c;this._stringValue=d};b.FieldRef.joiner="/";b.FieldRef.fromString=function(a){var c=a.indexOf(b.FieldRef.joiner);if(-1===c)throw"malformed field ref string";var d=a.slice(0,c);c=a.slice(c+1);return new b.FieldRef(c,d,a)};b.FieldRef.prototype.toString=function(){return null==this._stringValue&&(this._stringValue=this.fieldName+b.FieldRef.joiner+this.docRef),this._stringValue};b.Set=function(a){if(this.elements=Object.create(null),a){this.length=a.length;for(var c=0;c<this.length;c++)this.elements[a[c]]=!0}else this.length=0};b.Set.complete={intersect:function(a){return a},union:function(a){return a},contains:function(){return!0}};b.Set.empty={intersect:function(){return this},union:function(a){return a},contains:function(){return!1}};b.Set.prototype.contains=function(a){return!!this.elements[a]};b.Set.prototype.intersect=function(a){var c,d,e=[];if(a===b.Set.complete)return this;if(a===b.Set.empty)return a;this.length<a.length?(c=this,d=a):(c=a,d=this);a=Object.keys(c.elements);for(c=0;c<a.length;c++){var f=a[c];f in d.elements&&e.push(f)}return new b.Set(e)};b.Set.prototype.union=function(a){return a===b.Set.complete?b.Set.complete:a===b.Set.empty?this:new b.Set(Object.keys(this.elements).concat(Object.keys(a.elements)))};b.idf=function(a,c){var d=0,e;for(e in a)"_index"!=e&&(d+=Object.keys(a[e]).length);return Math.log(1+Math.abs((c-d+.5)/(d+.5)))};b.Token=function(a,c){this.str=a||"";this.metadata=c||{}};b.Token.prototype.toString=function(){return this.str};b.Token.prototype.update=function(a){return this.str=a(this.str,this.metadata),this};b.Token.prototype.clone=function(a){return a=a||function(c){return c},new b.Token(a(this.str,this.metadata),this.metadata)};b.tokenizer=function(a,c){if(null==a||null==a)return[];if(Array.isArray(a))return a.map(function(l){return new b.Token(b.utils.asString(l).toLowerCase(),b.utils.clone(c))});a=a.toString().trim().toLowerCase();for(var d=a.length,e=[],f=0,g=0;f<=d;f++){var h=f-g;if(a.charAt(f).match(b.tokenizer.separator)||f==d){if(0<h){var k=b.utils.clone(c)||{};k.position=[g,h];k.index=e.length;e.push(new b.Token(a.slice(g,f),k))}g=f+1}}return e};b.tokenizer.separator=/[\s\-]+/;b.Pipeline=function(){this._stack=[]};b.Pipeline.registeredFunctions=Object.create(null);b.Pipeline.registerFunction=function(a,c){c in this.registeredFunctions&&b.utils.warn("Overwriting existing registered function: "+
c);a.label=c;b.Pipeline.registeredFunctions[a.label]=a};b.Pipeline.warnIfFunctionNotRegistered=function(a){a.label&&a.label in this.registeredFunctions||b.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",a)};b.Pipeline.load=function(a){var c=new b.Pipeline;return a.forEach(function(d){var e=b.Pipeline.registeredFunctions[d];if(!e)throw Error("Cannot load unregistered function: "+d);c.add(e)}),c};b.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(a){b.Pipeline.warnIfFunctionNotRegistered(a);this._stack.push(a)},this)};b.Pipeline.prototype.after=function(a,c){b.Pipeline.warnIfFunctionNotRegistered(c);a=this._stack.indexOf(a);if(-1==a)throw Error("Cannot find existingFn");this._stack.splice(a+1,0,c)};b.Pipeline.prototype.before=function(a,c){b.Pipeline.warnIfFunctionNotRegistered(c);a=this._stack.indexOf(a);if(-1==a)throw Error("Cannot find existingFn");this._stack.splice(a,0,c)};b.Pipeline.prototype.remove=function(a){a=this._stack.indexOf(a);-1!=a&&this._stack.splice(a,1)};b.Pipeline.prototype.run=function(a){for(var c=this._stack.length,d=0;d<c;d++){for(var e=this._stack[d],f=[],g=0;g<a.length;g++){var h=e(a[g],g,a);if(void 0!==h&&""!==h)if(Array.isArray(h))for(var k=0;k<h.length;k++)f.push(h[k]);else f.push(h)}a=f}return a};b.Pipeline.prototype.runString=function(a,c){a=new b.Token(a,c);return this.run([a]).map(function(d){return d.toString()})};b.Pipeline.prototype.reset=function(){this._stack=[]};b.Pipeline.prototype.toJSON=function(){return this._stack.map(function(a){return b.Pipeline.warnIfFunctionNotRegistered(a),a.label})};b.Vector=function(a){this._magnitude=0;this.elements=a||[]};b.Vector.prototype.positionForIndex=function(a){if(0==this.elements.length)return 0;for(var c=0,d=this.elements.length/2,e=d-c,f=Math.floor(e/2),g=this.elements[2*f];1<e&&(g<a&&(c=f),a<g&&(d=f),g!=a);)e=d-c,f=c+Math.floor(e/2),g=this.elements[2*f];return g==a?2*f:a<g?2*f:g<a?2*(f+1):void 0};b.Vector.prototype.insert=function(a,c){this.upsert(a,c,function(){throw"duplicate index";})};b.Vector.prototype.upsert=function(a,c,d){this._magnitude=0;var e=this.positionForIndex(a);this.elements[e]==a?this.elements[e+1]=d(this.elements[e+1],c):this.elements.splice(e,0,a,c)};b.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var a=0,c=this.elements.length,d=1;d<c;d+=2){var e=this.elements[d];a+=e*e}return this._magnitude=Math.sqrt(a)};b.Vector.prototype.dot=function(a){var c=0,d=this.elements;a=a.elements;for(var e=d.length,f=a.length,g=0,h=0,k=0,l=0;k<e&&l<f;)(g=d[k])<(h=a[l])?k+=2:h<g?l+=2:g==h&&(c+=d[k+1]*a[l+1],k+=2,l+=2);return c};b.Vector.prototype.similarity=function(a){return this.dot(a)/this.magnitude()||0};b.Vector.prototype.toArray=function(){for(var a=Array(this.elements.length/2),c=1,d=0;c<this.elements.length;c+=2,d++)a[d]=this.elements[c];return a};b.Vector.prototype.toJSON=function(){return this.elements};b.stemmer=(n={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},p={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},q=RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),r=RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),x=RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$"),D=RegExp("^([^aeiou][^aeiouy]*)?[aeiouy]"),O=/^(.+?)(ss|i)es$/,P=/^(.+?)([^s])s$/,Q=/^(.+?)eed$/,R=/^(.+?)(ed|ing)$/,G=/.$/,S=/(at|bl|iz)$/,T=RegExp("([^aeiouylsz])\\1$"),U=RegExp("^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$"),V=/^(.+?[^aeiou])y$/,W=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,X=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,Y=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,Z=/^(.+?)(s|t)(ion)$/,aa=/^(.+?)e$/,ba=/ll$/,ca=RegExp("^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$"),da=function(a){var c,d,e,f,g;if(3>a.length)return a;if("y"==(d=a.substr(0,1))&&(a=d.toUpperCase()+a.substr(1)),f=P,(e=O).test(a)?a=a.replace(e,"$1$2"):f.test(a)&&(a=a.replace(f,"$1$2")),f=R,(e=Q).test(a)){var h=e.exec(a);(e=q).test(h[1])&&(e=G,a=a.replace(e,""))}else if(f.test(a)){var k=(h=f.exec(a))[1];D.test(k)&&(g=T,S.test(a=k)?a+="e":g.test(a)?(e=G,a=a.replace(e,"")):U.test(a)&&(a+="e"))}(e=V).test(a)&&(a=(k=(h=e.exec(a))[1])+"i");(e=W).test(a)&&(k=(h=e.exec(a))[1],c=h[2],(e=q).test(k)&&(a=k+
n[c]));(e=X).test(a)&&(k=(h=e.exec(a))[1],c=h[2],q.test(k)&&(a=k+p[c]));(f=Z,(e=Y).test(a))?(k=e.exec(a)[1],(e=r).test(k)&&(a=k)):f.test(a)&&(k=(h=f.exec(a))[1]+h[2],(f=r).test(k)&&(a=k));(e=aa).test(a)&&(k=e.exec(a)[1],f=x,g=ca,((e=r).test(k)||f.test(k)&&!g.test(k))&&(a=k));return f=r,ba.test(a)&&f.test(a)&&(e=G,a=a.replace(e,"")),"y"==d&&(a=d.toLowerCase()+a.substr(1)),a},function(a){return a.update(da)});b.Pipeline.registerFunction(b.stemmer,"stemmer");b.generateStopWordFilter=function(a){var c=a.reduce(function(d,e){return d[e]=e,d},{});return function(d){if(d&&c[d.toString()]!==d.toString())return d}};b.stopWordFilter=b.generateStopWordFilter("a able about across after all almost also am among an and any are as at be because been but by can cannot could dear did do does either else ever every for from get got had has have he her hers him his how however i if in into is it its just least let like likely may me might most must my neither no nor not of off often on only or other our own rather said say says she should since so some than that the their them then there these they this tis to too twas us wants was we were what when where which while who whom why will with would yet you your".split(" "));b.Pipeline.registerFunction(b.stopWordFilter,"stopWordFilter");b.trimmer=function(a){return a.update(function(c){return c.replace(/^\W+/,"").replace(/\W+$/,"")})};b.Pipeline.registerFunction(b.trimmer,"trimmer");b.TokenSet=function(){this.final=!1;this.edges={};this.id=b.TokenSet._nextId;b.TokenSet._nextId+=1};b.TokenSet._nextId=1;b.TokenSet.fromArray=function(a){for(var c=new b.TokenSet.Builder,d=0,e=a.length;d<e;d++)c.insert(a[d]);return c.finish(),c.root};b.TokenSet.fromClause=function(a){return"editDistance"in
a?b.TokenSet.fromFuzzyString(a.term,a.editDistance):b.TokenSet.fromString(a.term)};b.TokenSet.fromFuzzyString=function(a,c){var d=new b.TokenSet;for(a=[{node:d,editsRemaining:c,str:a}];a.length;){var e,f,g;c=a.pop();0<c.str.length&&((f=c.str.charAt(0))in c.node.edges?e=c.node.edges[f]:(e=new b.TokenSet,c.node.edges[f]=e),1==c.str.length&&(e.final=!0),a.push({node:e,editsRemaining:c.editsRemaining,str:c.str.slice(1)}));0<c.editsRemaining&&1<c.str.length&&((f=c.str.charAt(1))in c.node.edges?g=c.node.edges[f]:(g=new b.TokenSet,c.node.edges[f]=g),2>=c.str.length?g.final=!0:a.push({node:g,editsRemaining:c.editsRemaining-1,str:c.str.slice(2)}));if(0<c.editsRemaining&&1==c.str.length&&(c.node.final=!0),0<c.editsRemaining&&1<=c.str.length){if("*"in c.node.edges)var h=c.node.edges["*"];else h=new b.TokenSet,c.node.edges["*"]=h;1==c.str.length?h.final=!0:a.push({node:h,editsRemaining:c.editsRemaining-1,str:c.str.slice(1)})}0<c.editsRemaining&&("*"in c.node.edges?h=c.node.edges["*"]:(h=new b.TokenSet,c.node.edges["*"]=h),0==c.str.length?h.final=!0:a.push({node:h,editsRemaining:c.editsRemaining-1,str:c.str}));if(0<c.editsRemaining&&1<c.str.length){var k;h=c.str.charAt(0);var l=c.str.charAt(1);l in c.node.edges?k=c.node.edges[l]:(k=new b.TokenSet,c.node.edges[l]=k);1==c.str.length?k.final=!0:a.push({node:k,editsRemaining:c.editsRemaining-1,str:h+c.str.slice(2)})}}return d};b.TokenSet.fromString=function(a){for(var c=new b.TokenSet,d=c,e=0,f=a.length;e<f;e++){var g=a[e],h=e==f-1;if("*"==g)(c.edges[g]=c).final=h;else{var k=new b.TokenSet;k.final=h;c=c.edges[g]=k}}return d};b.TokenSet.prototype.toArray=function(){for(var a=[],c=[{prefix:"",node:this}];c.length;){var d=c.pop(),e=Object.keys(d.node.edges),f=e.length;d.node.final&&(d.prefix.charAt(0),a.push(d.prefix));for(var g=0;g<f;g++){var h=e[g];c.push({prefix:d.prefix.concat(h),node:d.node.edges[h]})}}return a};b.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var a=this.final?"1":"0",c=Object.keys(this.edges).sort(),d=c.length,e=0;e<d;e++){var f=c[e];a=a+f+this.edges[f].id}return a};b.TokenSet.prototype.intersect=function(a){for(var c=new b.TokenSet,d=[{qNode:a,output:c,node:this}];d.length;){a=d.pop();for(var e=Object.keys(a.qNode.edges),f=e.length,g=Object.keys(a.node.edges),h=g.length,k=0;k<f;k++)for(var l=e[k],t=0;t<h;t++){var u=g[t];if(u==l||"*"==l){var A=a.node.edges[u],C=a.qNode.edges[l],w=A.final&&C.final,y=void 0;u in a.output.edges?(y=a.output.edges[u]).final=y.final||w:((y=new b.TokenSet).final=w,a.output.edges[u]=y);d.push({qNode:C,output:y,node:A})}}}return c};b.TokenSet.Builder=function(){this.previousWord="";this.root=new b.TokenSet;this.uncheckedNodes=[];this.minimizedNodes={}};b.TokenSet.Builder.prototype.insert=function(a){var c=0;if(a<this.previousWord)throw Error("Out of order word insertion");for(var d=0;d<a.length&&d<this.previousWord.length&&a[d]==this.previousWord[d];d++)c++;this.minimize(c);var e=0==this.uncheckedNodes.length?this.root:this.uncheckedNodes[this.uncheckedNodes.length-1].child;for(d=c;d<a.length;d++){c=new b.TokenSet;var f=a[d];e.edges[f]=c;this.uncheckedNodes.push({parent:e,char:f,child:c});e=c}e.final=!0;this.previousWord=a};b.TokenSet.Builder.prototype.finish=function(){this.minimize(0)};b.TokenSet.Builder.prototype.minimize=function(a){for(var c=this.uncheckedNodes.length-1;a<=c;c--){var d=this.uncheckedNodes[c],e=d.child.toString();e in this.minimizedNodes?d.parent.edges[d.char]=this.minimizedNodes[e]:(d.child._str=e,this.minimizedNodes[e]=d.child);this.uncheckedNodes.pop()}};b.Index=function(a){this.invertedIndex=a.invertedIndex;this.fieldVectors=a.fieldVectors;this.tokenSet=a.tokenSet;this.fields=a.fields;this.pipeline=a.pipeline};b.Index.prototype.search=function(a){return this.query(function(c){(new b.QueryParser(a,c)).parse()})};b.Index.prototype.query=function(a){for(var c=new b.Query(this.fields),d=Object.create(null),e=Object.create(null),f=Object.create(null),g=Object.create(null),h=Object.create(null),k=0;k<this.fields.length;k++)e[this.fields[k]]=new b.Vector;a.call(c,c);for(k=0;k<c.clauses.length;k++){var l=c.clauses[k],t=null,u=b.Set.complete;t=l.usePipeline?this.pipeline.runString(l.term,{fields:l.fields}):[l.term];for(var A=0;A<t.length;A++){l.term=t[A];a=b.TokenSet.fromClause(l);var C=this.tokenSet.intersect(a).toArray();if(0===C.length&&l.presence===b.Query.presence.REQUIRED){for(var w=0;w<l.fields.length;w++)g[v=l.fields[w]]=b.Set.empty;break}for(var y=0;y<C.length;y++){var B=C[y],z=this.invertedIndex[B],H=z._index;for(w=0;w<l.fields.length;w++){var I=z[v=l.fields[w]],J=Object.keys(I),ea=B+"/"+
v;a=new b.Set(J);if(l.presence==b.Query.presence.REQUIRED&&(u=u.union(a),void 0===g[v]&&(g[v]=b.Set.complete)),l.presence!=b.Query.presence.PROHIBITED){if(e[v].upsert(H,l.boost,function(K,L){return K+L}),!f[ea]){for(var M=0;M<J.length;M++){var E,F=J[M];a=new b.FieldRef(F,v);F=I[F];void 0===(E=d[a])?d[a]=new b.MatchData(B,v,F):E.add(B,v,F)}f[ea]=!0}}else void 0===h[v]&&(h[v]=b.Set.empty),h[v]=h[v].union(a)}}}if(l.presence===b.Query.presence.REQUIRED)for(w=0;w<l.fields.length;w++)g[v=l.fields[w]]=g[v].intersect(u)}f=b.Set.complete;E=b.Set.empty;for(k=0;k<this.fields.length;k++){var v;g[v=this.fields[k]]&&(f=f.intersect(g[v]));h[v]&&(E=E.union(h[v]))}g=Object.keys(d);h=[];v=Object.create(null);if(c.isNegated())for(g=Object.keys(this.fieldVectors),k=0;k<g.length;k++)a=g[k],c=b.FieldRef.fromString(a),d[a]=new b.MatchData;for(k=0;k<g.length;k++)a=(c=b.FieldRef.fromString(g[k])).docRef,f.contains(a)&&!E.contains(a)&&(t=e[c.fieldName].similarity(this.fieldVectors[c]),void 0!==(l=v[a])?(l.score+=t,l.matchData.combine(d[c])):(c={ref:a,score:t,matchData:d[c]},v[a]=c,h.push(c)));return h.sort(function(K,L){return L.score-K.score})};b.Index.prototype.toJSON=function(){var a=Object.keys(this.invertedIndex).sort().map(function(d){return[d,this.invertedIndex[d]]},this),c=Object.keys(this.fieldVectors).map(function(d){return[d,this.fieldVectors[d].toJSON()]},this);return{version:b.version,fields:this.fields,fieldVectors:c,invertedIndex:a,pipeline:this.pipeline.toJSON()}};b.Index.load=function(a){var c={},d={},e=a.fieldVectors,f=Object.create(null),g=a.invertedIndex,h=new b.TokenSet.Builder,k=b.Pipeline.load(a.pipeline);a.version!=b.version&&b.utils.warn("Version mismatch when loading serialised index. Current version of lunr '"+b.version+"' does not match serialized index '"+a.version+"'");for(var l=0;l<e.length;l++){var t=(u=e[l])[0];d[t]=new b.Vector(u[1])}for(l=0;l<g.length;l++){var u;e=(u=g[l])[0];u=u[1];h.insert(e);f[e]=u}return h.finish(),c.fields=a.fields,c.fieldVectors=d,c.invertedIndex=f,c.tokenSet=h.root,c.pipeline=k,new b.Index(c)};b.Builder=function(){this._ref="id";this._fields=Object.create(null);this._documents=Object.create(null);this.invertedIndex=Object.create(null);this.fieldTermFrequencies={};this.fieldLengths={};this.tokenizer=b.tokenizer;this.pipeline=new b.Pipeline;this.searchPipeline=new b.Pipeline;this.documentCount=0;this._b=.75;this._k1=1.2;this.termIndex=0;this.metadataWhitelist=[]};b.Builder.prototype.ref=function(a){this._ref=a};b.Builder.prototype.field=function(a,c){if(/\//.test(a))throw new RangeError("Field '"+
a+"' contains illegal character '/'");this._fields[a]=c||{}};b.Builder.prototype.b=function(a){this._b=0>a?0:1<a?1:a};b.Builder.prototype.k1=function(a){this._k1=a};b.Builder.prototype.add=function(a,c){var d=a[this._ref],e=Object.keys(this._fields);this._documents[d]=c||{};this.documentCount+=1;for(c=0;c<e.length;c++){var f=e[c],g=this._fields[f].extractor;g=g?g(a):a[f];g=this.tokenizer(g,{fields:[f]});g=this.pipeline.run(g);var h=new b.FieldRef(d,f),k=Object.create(null);this.fieldTermFrequencies[h]=k;this.fieldLengths[h]=0;this.fieldLengths[h]+=g.length;for(h=0;h<g.length;h++){var l=g[h];if(null==k[l]&&(k[l]=0),k[l]+=1,null==this.invertedIndex[l]){var t=Object.create(null);t._index=this.termIndex;this.termIndex+=1;for(var u=0;u<e.length;u++)t[e[u]]=Object.create(null);this.invertedIndex[l]=t}null==this.invertedIndex[l][f][d]&&(this.invertedIndex[l][f][d]=Object.create(null));for(t=0;t<this.metadataWhitelist.length;t++){u=this.metadataWhitelist[t];var A=l.metadata[u];null==this.invertedIndex[l][f][d][u]&&(this.invertedIndex[l][f][d][u]=[]);this.invertedIndex[l][f][d][u].push(A)}}}};b.Builder.prototype.calculateAverageFieldLengths=function(){for(var a=Object.keys(this.fieldLengths),c=a.length,d={},e={},f=0;f<c;f++){var g=b.FieldRef.fromString(a[f]),h=g.fieldName;e[h]||(e[h]=0);e[h]+=1;d[h]||(d[h]=0);d[h]+=this.fieldLengths[g]}a=Object.keys(this._fields);for(f=0;f<a.length;f++)c=a[f],d[c]/=e[c];this.averageFieldLength=d};b.Builder.prototype.createFieldVectors=function(){for(var a={},c=Object.keys(this.fieldTermFrequencies),d=c.length,e=Object.create(null),f=0;f<d;f++){for(var g=b.FieldRef.fromString(c[f]),h=g.fieldName,k=this.fieldLengths[g],l=new b.Vector,t=this.fieldTermFrequencies[g],u=Object.keys(t),A=u.length,C=this._fields[h].boost||1,w=this._documents[g.docRef].boost||1,y=0;y<A;y++){var B;var z=u[y];var H=t[z],I=this.invertedIndex[z]._index;void 0===e[z]?(B=b.idf(this.invertedIndex[z],this.documentCount),e[z]=B):B=e[z];z=B*(this._k1+1)*H/(this._k1*(1-this._b+k/this.averageFieldLength[h]*this._b)+H);z*=C;z*=w;l.insert(I,Math.round(1E3*z)/1E3)}a[g]=l}this.fieldVectors=a};b.Builder.prototype.createTokenSet=function(){this.tokenSet=b.TokenSet.fromArray(Object.keys(this.invertedIndex).sort())};b.Builder.prototype.build=function(){return this.calculateAverageFieldLengths(),this.createFieldVectors(),this.createTokenSet(),new b.Index({invertedIndex:this.invertedIndex,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet,fields:Object.keys(this._fields),pipeline:this.searchPipeline})};b.Builder.prototype.use=function(a){var c=Array.prototype.slice.call(arguments,1);c.unshift(this);a.apply(this,c)};b.MatchData=function(a,c,d){for(var e=Object.create(null),f=Object.keys(d||{}),g=0;g<f.length;g++){var h=f[g];e[h]=d[h].slice()}this.metadata=Object.create(null);void 0!==a&&(this.metadata[a]=Object.create(null),this.metadata[a][c]=e)};b.MatchData.prototype.combine=function(a){for(var c=Object.keys(a.metadata),d=0;d<c.length;d++){var e=c[d],f=Object.keys(a.metadata[e]);null==this.metadata[e]&&(this.metadata[e]=Object.create(null));for(var g=0;g<f.length;g++){var h=f[g],k=Object.keys(a.metadata[e][h]);null==this.metadata[e][h]&&(this.metadata[e][h]=Object.create(null));for(var l=0;l<k.length;l++){var t=k[l];null==this.metadata[e][h][t]?this.metadata[e][h][t]=a.metadata[e][h][t]:this.metadata[e][h][t]=this.metadata[e][h][t].concat(a.metadata[e][h][t])}}}};b.MatchData.prototype.add=function(a,c,d){if(!(a in this.metadata))return this.metadata[a]=Object.create(null),void(this.metadata[a][c]=d);if(c in this.metadata[a])for(var e=Object.keys(d),f=0;f<e.length;f++){var g=e[f];g in this.metadata[a][c]?this.metadata[a][c][g]=this.metadata[a][c][g].concat(d[g]):this.metadata[a][c][g]=d[g]}else this.metadata[a][c]=d};b.Query=function(a){this.clauses=[];this.allFields=a};b.Query.wildcard=new String("*");b.Query.wildcard.NONE=0;b.Query.wildcard.LEADING=1;b.Query.wildcard.TRAILING=2;b.Query.presence={OPTIONAL:1,REQUIRED:2,PROHIBITED:3};b.Query.prototype.clause=function(a){return"fields"in a||(a.fields=this.allFields),"boost"in a||(a.boost=1),"usePipeline"in a||(a.usePipeline=!0),"wildcard"in a||(a.wildcard=b.Query.wildcard.NONE),a.wildcard&b.Query.wildcard.LEADING&&a.term.charAt(0)!=b.Query.wildcard&&(a.term="*"+a.term),a.wildcard&b.Query.wildcard.TRAILING&&a.term.slice(-1)!=b.Query.wildcard&&(a.term+="*"),"presence"in a||(a.presence=b.Query.presence.OPTIONAL),this.clauses.push(a),this};b.Query.prototype.isNegated=function(){for(var a=0;a<this.clauses.length;a++)if(this.clauses[a].presence!=b.Query.presence.PROHIBITED)return!1;return!0};b.Query.prototype.term=function(a,c){if(Array.isArray(a))return a.forEach(function(e){this.term(e,b.utils.clone(c))},this),this;var d=c||{};return d.term=a.toString(),this.clause(d),this};b.QueryParseError=function(a,c,d){this.name="QueryParseError";this.message=a;this.start=c;this.end=d};b.QueryParseError.prototype=Error();b.QueryLexer=function(a){this.lexemes=[];this.str=a;this.length=a.length;this.start=this.pos=0;this.escapeCharPositions=[]};b.QueryLexer.prototype.run=function(){for(var a=b.QueryLexer.lexText;a;)a=a(this)};b.QueryLexer.prototype.sliceString=function(){for(var a=[],c=this.start,d,e=0;e<this.escapeCharPositions.length;e++)d=this.escapeCharPositions[e],a.push(this.str.slice(c,d)),c=d+1;return a.push(this.str.slice(c,this.pos)),this.escapeCharPositions.length=0,a.join("")};b.QueryLexer.prototype.emit=function(a){this.lexemes.push({type:a,str:this.sliceString(),start:this.start,end:this.pos});this.start=this.pos};b.QueryLexer.prototype.escapeCharacter=function(){this.escapeCharPositions.push(this.pos-
1);this.pos+=1};b.QueryLexer.prototype.next=function(){if(this.pos>=this.length)return b.QueryLexer.EOS;var a=this.str.charAt(this.pos);return this.pos+=1,a};b.QueryLexer.prototype.width=function(){return this.pos-this.start};b.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1);this.start=this.pos};b.QueryLexer.prototype.backup=function(){--this.pos};b.QueryLexer.prototype.acceptDigitRun=function(){for(var a,c;47<(c=(a=this.next()).charCodeAt(0))&&58>c;);a!=b.QueryLexer.EOS&&this.backup()};b.QueryLexer.prototype.more=function(){return this.pos<this.length};b.QueryLexer.EOS="EOS";b.QueryLexer.FIELD="FIELD";b.QueryLexer.TERM="TERM";b.QueryLexer.EDIT_DISTANCE="EDIT_DISTANCE";b.QueryLexer.BOOST="BOOST";b.QueryLexer.PRESENCE="PRESENCE";b.QueryLexer.lexField=function(a){return a.backup(),a.emit(b.QueryLexer.FIELD),a.ignore(),b.QueryLexer.lexText};b.QueryLexer.lexTerm=function(a){if(1<a.width()&&(a.backup(),a.emit(b.QueryLexer.TERM)),a.ignore(),a.more())return b.QueryLexer.lexText};b.QueryLexer.lexEditDistance=function(a){return a.ignore(),a.acceptDigitRun(),a.emit(b.QueryLexer.EDIT_DISTANCE),b.QueryLexer.lexText};b.QueryLexer.lexBoost=function(a){return a.ignore(),a.acceptDigitRun(),a.emit(b.QueryLexer.BOOST),b.QueryLexer.lexText};b.QueryLexer.lexEOS=function(a){0<a.width()&&a.emit(b.QueryLexer.TERM)};b.QueryLexer.termSeparator=b.tokenizer.separator;b.QueryLexer.lexText=function(a){for(;;){var c=a.next();if(c==b.QueryLexer.EOS)return b.QueryLexer.lexEOS;if(92!=c.charCodeAt(0)){if(":"==c)return b.QueryLexer.lexField;if("~"==c)return a.backup(),0<a.width()&&a.emit(b.QueryLexer.TERM),b.QueryLexer.lexEditDistance;if("^"==c)return a.backup(),0<a.width()&&a.emit(b.QueryLexer.TERM),b.QueryLexer.lexBoost;if("+"==c&&1===a.width()||"-"==c&&1===a.width())return a.emit(b.QueryLexer.PRESENCE),b.QueryLexer.lexText;if(c.match(b.QueryLexer.termSeparator))return b.QueryLexer.lexTerm}else a.escapeCharacter()}};b.QueryParser=function(a,c){this.lexer=new b.QueryLexer(a);this.query=c;this.currentClause={};this.lexemeIdx=0};b.QueryParser.prototype.parse=function(){this.lexer.run();this.lexemes=this.lexer.lexemes;for(var a=b.QueryParser.parseClause;a;)a=a(this);return this.query};b.QueryParser.prototype.peekLexeme=function(){return this.lexemes[this.lexemeIdx]};b.QueryParser.prototype.consumeLexeme=function(){var a=this.peekLexeme();return this.lexemeIdx+=1,a};b.QueryParser.prototype.nextClause=function(){this.query.clause(this.currentClause);this.currentClause={}};b.QueryParser.parseClause=function(a){a=a.peekLexeme();if(null!=a)switch(a.type){case b.QueryLexer.PRESENCE:return b.QueryParser.parsePresence;case b.QueryLexer.FIELD:return b.QueryParser.parseField;case b.QueryLexer.TERM:return b.QueryParser.parseTerm;default:var c="expected either a field or a term, found "+a.type;throw 1<=a.str.length&&(c+=" with value '"+a.str+"'"),new b.QueryParseError(c,a.start,a.end);}};b.QueryParser.parsePresence=function(a){var c=a.consumeLexeme();if(null!=c){switch(c.str){case "-":a.currentClause.presence=b.Query.presence.PROHIBITED;break;case "+":a.currentClause.presence=b.Query.presence.REQUIRED;break;default:throw a="unrecognised presence operator'"+c.str+"'",new b.QueryParseError(a,c.start,c.end);}var d=a.peekLexeme();if(null==d)throw new b.QueryParseError("expecting term or field, found nothing",c.start,c.end);switch(d.type){case b.QueryLexer.FIELD:return b.QueryParser.parseField;case b.QueryLexer.TERM:return b.QueryParser.parseTerm;default:throw a="expecting term or field, found '"+d.type+"'",new b.QueryParseError(a,d.start,d.end);}}};b.QueryParser.parseField=function(a){var c=a.consumeLexeme();if(null!=c){if(-1==a.query.allFields.indexOf(c.str))throw a=a.query.allFields.map(function(e){return"'"+e+"'"}).join(", "),a="unrecognised field '"+c.str+"', possible fields: "+a,new b.QueryParseError(a,c.start,c.end);a.currentClause.fields=[c.str];var d=a.peekLexeme();if(null==d)throw new b.QueryParseError("expecting term, found nothing",c.start,c.end);switch(d.type){case b.QueryLexer.TERM:return b.QueryParser.parseTerm;default:throw a="expecting term, found '"+d.type+"'",new b.QueryParseError(a,d.start,d.end);}}};b.QueryParser.parseTerm=function(a){var c=a.consumeLexeme();if(null!=c)if(a.currentClause.term=c.str.toLowerCase(),-1!=c.str.indexOf("*")&&(a.currentClause.usePipeline=!1),c=a.peekLexeme(),null!=c)switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;case b.QueryLexer.PRESENCE:return a.nextClause(),b.QueryParser.parsePresence;default:throw new b.QueryParseError("Unexpected lexeme type '"+c.type+"'",c.start,c.end);}else a.nextClause()};b.QueryParser.parseEditDistance=function(a){var c=a.consumeLexeme();if(null!=c){var d=parseInt(c.str,10);if(isNaN(d))throw new b.QueryParseError("edit distance must be numeric",c.start,c.end);a.currentClause.editDistance=d;c=a.peekLexeme();if(null!=c)switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;case b.QueryLexer.PRESENCE:return a.nextClause(),b.QueryParser.parsePresence;default:throw a="Unexpected lexeme type '"+c.type+"'",new b.QueryParseError(a,c.start,c.end);}else a.nextClause()}};b.QueryParser.parseBoost=function(a){var c=a.consumeLexeme();if(null!=c){var d=parseInt(c.str,10);if(isNaN(d))throw new b.QueryParseError("boost must be numeric",c.start,c.end);a.currentClause.boost=d;c=a.peekLexeme();if(null!=c)switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;case b.QueryLexer.PRESENCE:return a.nextClause(),b.QueryParser.parsePresence;default:throw a="Unexpected lexeme type '"+c.type+"'",new b.QueryParseError(a,c.start,c.end);}else a.nextClause()}};var N=function(){return b};"function"==typeof define&&define.amd?define(N):"object"==typeof exports?module.exports=N():this.lunr=N()}();